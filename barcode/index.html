<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width">
<style type="text/css">
</style>

</head>
  <body>

    <form id="form" class="center" onsubmit="return onSubmit(this)">
        <p>
		<label for="text">Title:</label></td>
		<input type="text" id="title" maxlength="13" size="13" style="width:20em"/></td>
        </p>
        <p>
		<label for="text">Barcode:</label></td>
		<input type="text" id="barcode" maxlength="13" size="13" style="width:20em"/></td>
        </p>
        <a class="button save" href="javascript:onSubmit(document.form)" id="savebutton">Save</a>
        <a class="button delete" href="javascript:onCancel()"  id="cancelbutton">Cancel</a>
    </form>
    
    <script>

        (function() {        
            load();
        })();
        function save(){
            localStorage.setItem('1', document.getElementById('title').value);
            localStorage.setItem('2', document.getElementById('barcode').value);
        }
        function load(){    
            document.getElementById("title").value = JSON.parse(localStorage.getItem('1'));
            document.getElementById("barcode").value = JSON.parse(localStorage.getItem('2'));
        }
        
        // assign function to onclick property of checkbox
        document.getElementById('savebutton').onclick = function() {
        save();
        };        
        
        var config = JSON.parse(decodeURIComponent('"REPLACE_ME_AT_RUNTIME"'));
        for (var which in config) {
            if (form[which]) for (var i = 0; i < form[which].length; i++) {
                var radio = form[which][i];
                radio.checked = radio.value == config[which];
            }
        }
        
  // Something like this to get query variables.
function getQueryParam(variable, default_) {
    var query = location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (pair[0] == variable)
            return decodeURIComponent(pair[1]);
    }
    return default_ || false;
}
        
        
        function onSubmit(e) {
            var result = {};
            var inputs = form.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++){
                result[inputs[i].id] = inputs[i].value;
                }
            }

      console.log("Submit");
      var return_to = getQueryParam('return_to', 'pebblejs://close#');
      document.location = return_to + encodeURIComponent(JSON.stringify(result));

            return false;
        }
            function onCancel() {
            window.location.href = "pebblejs://close#" ;
            return false;
        }
    
        
            </script>
</body>
</html>
